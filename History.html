<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ตรวจสอบประวัติการลา (LIFF)</title>
<style>
  /* นำเข้าฟอนต์ Prompt จาก Google Fonts */
  @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap');

  /* การตั้งค่าพื้นฐานสำหรับ body */
  body {
    font-family: 'Prompt', sans-serif;
    background-color: #f0f2f5;
    color: #333;
    padding: 16px;
    margin: 0;
  }

  /* จัดรูปแบบสำหรับ heading */
  h2 {
    color: #1a237e;
    text-align: center;
    margin-bottom: 24px;
    font-weight: 600;
    font-size: 1.5rem;
  }
  
  /*
  ==========================================
  รูปแบบ UI แบบใหม่: Card Layout
  ==========================================
  */
  
  /* ตัวห่อหุ้มรายการทั้งหมด */
  .card-container {
    display: flex;
    flex-direction: column;
    gap: 16px; /* ระยะห่างระหว่างการ์ดแต่ละอัน */
  }

  /* การ์ดแต่ละอัน (Item) */
  .card {
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    padding: 20px;
    transition: transform 0.2s ease-in-out;
  }

  .card:hover {
    transform: translateY(-4px); /* เพิ่ม effect ยกขึ้นเล็กน้อยเมื่อชี้ */
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
  }

  /* แถวข้อมูลแต่ละอันในการ์ด */
  .card-item {
    display: flex; /* จัดเรียงหัวข้อและข้อมูลในแนวนอน */
    align-items: flex-start;
    margin-bottom: 8px;
    line-height: 1.5;
  }

  .card-item:last-child {
    margin-bottom: 0;
  }

  /* หัวข้อของข้อมูล */
  .card-item-label {
    font-weight: 600;
    color: #4a4a4a;
    width: 120px; /* กำหนดความกว้างของหัวข้อเพื่อให้ข้อมูลจัดเรียงสวยงาม */
    flex-shrink: 0; /* ป้องกันหัวข้อไม่ให้ถูกบีบ */
  }

  /* ข้อมูลจริง */
  .card-item-value {
    color: #666;
    flex-grow: 1; /* ข้อมูลจะขยายเต็มพื้นที่ที่เหลือ */
    word-wrap: break-word; /* ทำให้ข้อความยาวๆ ขึ้นบรรทัดใหม่ได้ */
  }
  
  /* จัดรูปแบบข้อความแสดงสถานะ */
  .status-message {
    text-align: center;
    padding: 24px;
    font-size: 1.1rem;
    color: #757575;
    background-color: #fff;
    border-radius: 12px;
    margin-top: 24px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }

  .status-message.error {
    color: #d32f2f;
  }
</style>
</head>
<body>

  <h2>ตรวจสอบประวัติการลา</h2>

  <div id="dataContainer" class="card-container">
    <div class="status-message">⏳ กำลังโหลด...</div>
  </div>
  
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    async function fetchHistory() {
      try {
        await liff.init({ liffId: "2007956727-6V7DrnMD" });
        if (!liff.isLoggedIn()) { liff.login(); return; }

        const profile = await liff.getProfile();
        const lineUserId = profile.userId;

        const webAppUrl = "https://script.google.com/macros/s/AKfycbyMSCCq9FvSx-ovt3dUVkJ525R9YX5wJnZQoBYOsWNbrxpklT0njy5UzmljCrbfTVww/exec?lineUserId=" + lineUserId;
        const resp = await fetch(webAppUrl);
        const data = await resp.json();

        const container = document.getElementById("dataContainer");
        container.innerHTML = ""; // เคลียร์สถานะ loading

        if (!data || data.length === 0) {
          container.innerHTML = `<div class="status-message">❌ ไม่พบข้อมูล</div>`;
          return;
        }

        // กำหนดหัวข้อสำหรับแต่ละ Column
        // คุณสามารถแก้ไขหัวข้อเหล่านี้ให้ตรงกับความหมายของข้อมูลจริงได้เลย
        const headers = [
          "Column A", "Column B", "Column C", "Column D", "Column E",
          "Column F", "Column G", "Column H", "Column I", "Column J",
          "Column K", "Column L", "Column M", "Column N (File ID)", "Column O"
        ];

        data.forEach(row => {
          const card = document.createElement("div");
          card.className = "card";
          
          row.forEach((cell, idx) => {
            const cardItem = document.createElement("div");
            cardItem.className = "card-item";

            const label = document.createElement("span");
            label.className = "card-item-label";
            label.textContent = headers[idx] + ":";

            const value = document.createElement("span");
            value.className = "card-item-value";
            value.textContent = cell || "-";

            cardItem.appendChild(label);
            cardItem.appendChild(value);
            card.appendChild(cardItem);
          });
          container.appendChild(card);
        });

      } catch (err) {
        console.error(err);
        document.getElementById("dataContainer").innerHTML =
          `<div class="status-message error">❌ เกิดข้อผิดพลาดในการโหลดข้อมูล</div>`;
      }
    }

    fetchHistory();
  </script>
</body>
</html>
