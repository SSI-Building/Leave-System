<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
:root {
  --primary-color-start: #1994b6;
  --primary-color-end: #36a761;
  --text-color: #333;
  --light-text-color: #666;
  --background-color: #f0f2f5;
  --card-background: #ffffff;
  --shadow-light: 0 4px 15px rgba(0,0,0,0.08);
  --border-color: #e0e0e0;
}
/* ===== Custom Theme Colors Override ===== */
body.theme-custom {
  --primary-color-start: var(--custom-primary-start);
  --primary-color-end: var(--custom-primary-end);
}
/* ===== Theme Variants ===== */
body.theme-orange-purple {
  --primary-color-start: #ff7e5f;
  --primary-color-end: #6a11cb;
}
body.theme-blue-violet {
  --primary-color-start: #36d1dc;
  --primary-color-end: #5b86e5;
}
body.theme-pink-purple {
  --primary-color-start: #ff758c;
  --primary-color-end: #8e44ad;
}
body.theme-green-gold {
  --primary-color-start: #11998e;
  --primary-color-end: #fbc531;
}
body.theme-red-orange {
  --primary-color-start: #f12711;
  --primary-color-end: #f5af19;
}
body.theme-teal-navy {
  --primary-color-start: #2b5876;
  --primary-color-end: #4e4376;
}
body.theme-monochrome {
  --primary-color-start: #555;
  --primary-color-end: #999;
}
body.theme-dark {
  --primary-color-start: #141E30;
  --primary-color-end: #243B55;
  --text-color: #fff;
  --light-text-color: #bbb;
  --background-color: #181818;
  --card-background: #242424;
  --border-color: #444;
}
/* ===== Custom Theme Colors Override ===== */
body.theme-custom {
  --primary-color-start: var(--custom-primary-start);
  --primary-color-end: var(--custom-primary-end);
}

/* ===== Base Styles ===== */
body {
  font-family: 'Prompt', sans-serif;
  background: var(--background-color);
  margin:0;
  padding:20px;
  color:var(--text-color);
  transition: all 0.3s ease;
  min-height: 100vh;
  box-sizing: border-box;
}
.container {
  max-width: 600px;
  margin:auto;
  position:relative;
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.5s ease, transform 0.5s ease;
}
.container.loaded {
  opacity: 1;
  transform: translateY(0);
}

.header {
  display:flex; align-items:center; gap:15px; margin-bottom:30px;
  background: linear-gradient(135deg, var(--primary-color-start), var(--primary-color-end));
  padding:25px; border-radius:15px; color:#fff;
  box-shadow:var(--shadow-light); position:relative;
}
.profile-pic {
  width:60px; height:60px; border-radius:50%;
  background:rgba(255,255,255,0.2); object-fit:cover;
  border:3px solid rgba(255,255,255,0.5);
}
.greeting { font-size:20px; font-weight:600; }
.motivation { font-size:14px; color:rgba(255,255,255,0.8); margin-top:5px; }

/* Settings and Logout Icons */
.header-icons {
    position:absolute;
    top:25px;
    right:25px;
    display:flex;
    flex-direction:column;
    gap:10px;
}
.settings-icon, .logout-icon {
    font-size:24px;
    color:#fff;
    cursor:pointer;
    transition: transform 0.2s ease;
}
.settings-icon:hover, .logout-icon:hover {
    transform: scale(1.1);
}


/* Theme Selector */
.theme-selector {
  position:absolute; top:60px; right:25px;
  background:var(--card-background);
  padding:10px; border-radius:8px;
  box-shadow:var(--shadow-light);
  display:none; flex-direction:column; gap:10px; z-index:10;
}
.theme-selector.active { display:flex; }
.theme-option {
  padding:8px 12px; border-radius:6px;
  cursor:pointer; font-size:14px; font-weight:500;
  border:1px solid var(--border-color); text-align:center;
  transition: all 0.3s ease;
}
.theme-option:hover { background: var(--background-color); }
.theme-preview {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: inline-block;
    vertical-align: middle;
    margin-right: 10px;
    background: linear-gradient(45deg, var(--color-start), var(--color-end));
}


/* Tabs */
.tabs-container { background: var(--card-background); padding:10px; border-radius:12px; box-shadow: var(--shadow-light); margin-bottom:20px; }
.tabs { display:flex; border-radius:8px; }
.tab {
  flex:1; text-align:center; padding:12px 0; cursor:pointer;
  font-weight:500; color: var(--light-text-color); transition: all 0.3s ease;
}
.tab.active {
  background: linear-gradient(135deg, var(--primary-color-start), var(--primary-color-end));
  color:#fff; font-weight:600; border-radius:8px;
  box-shadow:0 4px 8px rgba(0,0,0,0.1);
}
.tab-content { display:none; padding-top:20px; }
.tab-content.active { display:block; }

/* Tables */
.table-container { background: var(--card-background); border-radius:12px; overflow:hidden; box-shadow: var(--shadow-light); margin-bottom:20px; }
table { width:100%; border-collapse:collapse; }
th, td {
  padding:15px; text-align:center; font-size:15px; border-bottom:1px solid var(--border-color);
}
th { background: var(--background-color); font-weight:600; color: var(--text-color); }
tr:last-child td { border-bottom:none; }

/* Buttons */
.buttons { display:flex; gap:15px; margin-top:20px; }
.btn {
  flex:1; padding:15px; border:none; border-radius:10px;
  font-weight:600; cursor:pointer; font-size:16px;
  display:flex; align-items:center; justify-content:center; gap:8px;
  box-shadow:0 4px 8px rgba(0,0,0,0.1);
  color:#fff; background: linear-gradient(45deg, var(--primary-color-start), var(--primary-color-end));
  transition: all 0.3s ease;
}
.btn:hover { box-shadow:0 6px 12px rgba(0,0,0,0.15); transform:translateY(-2px); }

/* Loading Screen Styles */
.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: var(--background-color);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  transition: opacity 0.5s ease;
  flex-direction: column;
  gap: 20px;
}

.loading-screen.hidden {
  opacity: 0;
  pointer-events: none;
}

.spinner {
  border: 5px solid var(--border-color);
  border-top: 5px solid var(--primary-color-end);
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
}

.loading-text {
  color: var(--text-color);
  font-size: 1.2em;
  font-weight: 500;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
const liffId = "2007956727-6V7DrnMD";
const GAS_URL = "https://script.google.com/macros/s/AKfycbypGDcud4AH8zMe4ySfQpcG8CxvFpLaD83E8C0t739Nh8A2bRTnr1-4UpxGwqSJ0FRu/exec";
let selectedTheme = null;

const messages = [
  "ยินดีต้อนรับเข้าสู่ระบบ!", "ดีใจที่เจอคุณวันนี้!", "สู้ ๆ กับวันใหม่ครับ!",
  "ขอให้วันนี้เป็นวันที่ดี!", "ยิ้มรับความท้าทายวันนี้!", "ขอให้มีความสุขกับการทำงาน!",
  "มาสำรวจสิทธิ์ลาของคุณกัน!", "วันนี้ก็ทำได้ดีแน่นอนครับ!", "เริ่มต้นวันใหม่ด้วยพลังบวกกันเถอะ!",
  "ไม่ว่าอะไรเกิดขึ้น คุณก็เอาอยู่!", "ยินดีที่ได้เจอกันอีกครั้งนะครับ!", "ขอบคุณที่ตั้งใจทำงานเสมอ!",
  "มาลุยงานกันอย่างเต็มที่เลยครับ!", "พักบ้างก็ได้นะ แต่ห้ามยอมแพ้!", "เชื่อมั่นในตัวเอง แล้วก้าวต่อไปครับ!",
  "วันนี้อาจเจอความท้าทาย แต่คุณเก่งพอ!", "ขอให้วันนี้มีรอยยิ้มเยอะ ๆ นะครับ!"
];

  function formatNumber(num) {
  if (num === "" || num === null || isNaN(num)) return num;
  return Number.isInteger(Number(num)) ? Number(num) : Number(num).toFixed(1);
  }


async function loadDashboard() {
  await liff.init({ liffId });
  if(!liff.isLoggedIn()){ liff.login(); return; }

  const profile = await liff.getProfile();
  const userId = profile.userId;
  document.getElementById("profilePic").src = profile.pictureUrl;

  const randomMessage = messages[Math.floor(Math.random() * messages.length)];
  document.getElementById("motivation").textContent = randomMessage;

  fetch(`${GAS_URL}?action=getBalance&userId=${userId}`)
    .then(res => res.json())
    .then(data => {
      if(data.error){ alert(data.error); return; }
      
      localStorage.setItem("leaveSet1", JSON.stringify(data.set1));
      localStorage.setItem("leaveSet2", JSON.stringify(data.set2));

      
      document.getElementById("empName").textContent = data.set1[1];
      document.getElementById("remainTable").innerHTML = `
        <tr><th>ประเภทการลา</th><th>จำนวนวัน</th></tr>
        <tr><td>ลาพักร้อน</td><td>${formatNumber(data.set1[3])}</td></tr>
        <tr><td>ลาป่วย</td><td>${formatNumber(data.set1[4])}</td></tr>
        <tr><td>ลากิจ</td><td>${formatNumber(data.set1[5])}</td></tr>`;
      document.getElementById("usedTable").innerHTML = `
        <tr><th>ประเภทการลา</th><th>จำนวนวัน</th></tr>
        <tr><td>ลาพักร้อน</td><td>${formatNumber(data.set2[3])}</td></tr>
        <tr><td>ลาป่วย</td><td>${formatNumber(data.set2[4])}</td></tr>
        <tr><td>ลากิจ</td><td>${formatNumber(data.set2[5])}</td></tr>
        <tr><td>ขาดงานสะสม</td><td>${formatNumber(data.set2[6])}</td></tr>`;
    })
    .catch(err => {
      console.error(err);
      alert("เกิดข้อผิดพลาดในการโหลดข้อมูล: " + err.message);
    })
    .finally(() => {
      document.getElementById("loadingScreen").classList.add('hidden');
      document.getElementById("mainContainer").classList.add('loaded');
    });
}

window.onload = () => {
    const savedTheme = localStorage.getItem('selectedTheme');
    if (savedTheme) {
        document.body.className = savedTheme;
        // ตรวจสอบว่าธีมที่บันทึกไว้คือ custom theme หรือไม่
        if (savedTheme === 'theme-custom') {
            const savedColorStart = localStorage.getItem('customColorStart');
            const savedColorEnd = localStorage.getItem('customColorEnd');
            if (savedColorStart && savedColorEnd) {
                // ถ้าเป็น custom theme ให้กำหนดค่าสีที่บันทึกไว้ใน localStorage
                document.body.style.setProperty('--custom-primary-start', savedColorStart);
                document.body.style.setProperty('--custom-primary-end', savedColorEnd);
            }
        }
    }
    loadDashboard();
};
  
document.addEventListener("DOMContentLoaded", ()=>{
  const settingsIcon = document.getElementById('settingsIcon');
  const logoutIcon = document.getElementById('logoutIcon');
  const themeSelector = document.getElementById('themeSelector');

  settingsIcon.addEventListener('click', () => {
      themeSelector.classList.toggle('active');
  });

  // แก้ไขให้กลับไปหน้า Login.html โดยไม่ลบข้อมูลใน localStorage
  logoutIcon.addEventListener('click', () => {
    window.location.href = 'Login.html';
  });

  document.querySelectorAll('.theme-option').forEach(option => {
      option.addEventListener('click', function() {
          const theme = this.getAttribute('data-theme');
          document.body.className = theme;
          localStorage.setItem('selectedTheme', theme);
          themeSelector.classList.remove('active');
      });
  });
});

function openTab(evt, tabId){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"));
  evt.currentTarget.classList.add("active");
  document.getElementById(tabId).classList.add("active");
}
</script>
</head>
<body>
<div class="loading-screen" id="loadingScreen">
    <div class="spinner"></div>
    <div class="loading-text">กำลังโหลดข้อมูล...</div>
</div>

<div class="container" id="mainContainer">
  <div class="header">
    <img id="profilePic" class="profile-pic" src="" alt="Profile">
    <div>
      <div class="greeting">Hi, <span id="empName">Username</span></div>
      <div class="motivation" id="motivation"></div>
    </div>
    <div class="header-icons">
        <i class="fas fa-cog settings-icon" id="settingsIcon"></i>
        <i class="fas fa-sign-out-alt logout-icon" id="logoutIcon"></i>
    </div>
  </div>

  <div class="theme-selector" id="themeSelector">
    <div class="theme-option" data-theme="theme-default">
      <span class="theme-preview" style="--color-start: #1994b6; --color-end: #36a761;"></span>Default color (Blue-Green)
    </div>
    <div class="theme-option" data-theme="theme-orange-purple">
      <span class="theme-preview" style="--color-start: #ff7e5f; --color-end: #6a11cb;"></span>Orange-Purple
    </div>
    <div class="theme-option" data-theme="theme-blue-violet">
      <span class="theme-preview" style="--color-start: #36d1dc; --color-end: #5b86e5;"></span>Blue-Purple
    </div>
    <div class="theme-option" data-theme="theme-pink-purple">
      <span class="theme-preview" style="--color-start: #ff758c; --color-end: #8e44ad;"></span>Pink-Purple
    </div>
    <div class="theme-option" data-theme="theme-green-gold">
      <span class="theme-preview" style="--color-start: #11998e; --color-end: #fbc531;"></span>Green-Gold
    </div>
    <div class="theme-option" data-theme="theme-red-orange">
      <span class="theme-preview" style="--color-start: #f12711; --color-end: #f5af19;"></span>Red-Orange
    </div>
    <div class="theme-option" data-theme="theme-teal-navy">
      <span class="theme-preview" style="--color-start: #2b5876; --color-end: #4e4376;"></span>Teal-Navy
    </div>
    <div class="theme-option" data-theme="theme-monochrome">
      <span class="theme-preview" style="--color-start: #555; --color-end: #999;"></span>Monochrome
    </div>
    <div class="theme-option" data-theme="theme-dark">
      <span class="theme-preview" style="--color-start: #141E30; --color-end: #243B55;"></span>Dark Mode
    </div>
  </div>

  <div class="tabs-container">
    <div class="tabs">
      <div class="tab active" onclick="openTab(event,'remain')">สิทธิลาคงเหลือ</div>
      <div class="tab" onclick="openTab(event,'used')">สิทธิลาที่ใช้</div>
    </div>
  </div>

  <div class="table-container">
    <div id="remain" class="tab-content active"><table id="remainTable"></table></div>
    <div id="used" class="tab-content"><table id="usedTable"></table></div>
  </div>

  <div class="buttons">
    <button class="btn" onclick="window.location.href='leaveform.html'">
      <i class="fas fa-calendar-plus"></i> ลาออนไลน์
    </button>
      <button class="btn" onclick="window.location.href='History.html'">
    <i class="fas fa-history"></i> ตรวจสอบสถานะ
  </button>
  </div>
</div>
</body>
</html>
