<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Test Dashboard</title>
<style>
  body { font-family: 'Prompt', sans-serif; padding: 20px; }
  .loading {
    position: fixed;
    top: 0; left: 0; right:0; bottom:0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255,255,255,0.9);
    font-size: 20px;
    font-weight: bold;
    z-index: 1000;
  }

  table { border-collapse: collapse; margin-bottom: 20px; width: 100%; display:none; }
  th, td { border: 1px solid #333; padding: 8px; text-align: center; }
  th { background-color: #eee; }
</style>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
const liffId = "2007956727-6V7DrnMD";
const GAS_URL = "https://script.google.com/macros/s/AKfycbypGDcud4AH8zMe4ySfQpcG8CxvFpLaD83E8C0t739Nh8A2bRTnr1-4UpxGwqSJ0FRu/exec";

async function loadData() {
  const loadingDiv = document.getElementById("loading");
  const balanceTable = document.getElementById("balanceTable");
  const recordsTable = document.getElementById("recordsTable");

  try {
    await liff.init({ liffId });

    if (!liff.isLoggedIn()) {
      liff.login();
      return;
    }

    const profile = await liff.getProfile();
    const userId = profile.userId;

    const res = await fetch(`${GAS_URL}?action=getBalance&userId=${userId}`);
    const data = await res.json();

    if (data.error) {
      alert(data.error);
      loadingDiv.innerText = "เกิดข้อผิดพลาด: ไม่พบข้อมูล";
      return;
    }

    // สร้างตาราง Balance
    const headerB = ["รหัสพนักงาน","ชื่อ-สกุล","ตำแหน่ง","พักร้อน","ป่วย","กิจ","-","LineUserID"];
    let htmlB = "<tr>" + headerB.map(h => `<th>${h}</th>`).join("") + "</tr>";
    htmlB += "<tr>" + data.set1.map(v => `<td>${v}</td>`).join("") + "</tr>";
    balanceTable.innerHTML = htmlB;

    // สร้างตาราง Records
    const headerR = ["รหัสพนักงาน","ชื่อ-สกุล","ตำแหน่ง","พักร้อน","ป่วย","กิจ","ขาดงาน"];
    let htmlR = "<tr>" + headerR.map(h => `<th>${h}</th>`).join("") + "</tr>";
    htmlR += "<tr>" + data.set2.map(v => `<td>${v}</td>`).join("") + "</tr>";
    recordsTable.innerHTML = htmlR;

    // แสดงตารางและซ่อน loading
    loadingDiv.style.display = "none";
    balanceTable.style.display = "table";
    recordsTable.style.display = "table";

  } catch(err) {
    console.error(err);
    loadingDiv.innerText = "เกิดข้อผิดพลาดในการโหลดข้อมูล";
  }
}

document.addEventListener("DOMContentLoaded", loadData);
</script>
</head>
<body>
<div id="loading" class="loading">กำลังโหลดข้อมูล...</div>

<h2>Balance</h2>
<table id="balanceTable"></table>

<h2>Records</h2>
<table id="recordsTable"></table>
</body>
</html>
