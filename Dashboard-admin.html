<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>History Table</title>
<style>
  body { font-family: 'Prompt', sans-serif; padding: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background-color: #f2f2f2; }
</style>
</head>
<body>

<h2>History Table</h2>

<label>จากวันที่: <input type="date" id="startDate"></label>
<label>ถึงวันที่: <input type="date" id="endDate"></label>
<button onclick="loadData()">ดึงข้อมูล</button>

<table id="historyTable">
  <thead>
    <tr>
      <th>A</th><th>B</th><th>C</th><th>D</th><th>E</th>
      <th>F</th><th>G</th><th>H</th><th>I</th><th>J</th>
      <th>K</th><th>L</th><th>M</th><th>N</th><th>O</th>
      <th>P</th><th>Q</th><th>R</th><th>S</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const webAppURL = 'https://script.google.com/macros/s/AKfycbx2Y2ChK_CSCUr5xOe5TX0dxSIbOjtnFNWCwqUFRroi2OtLQgDRfxGX41k2O2DHm1Mt/exec';

function loadData() {
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;

  if (!startDate || !endDate) {
    alert("กรุณาเลือกช่วงวันที่");
    return;
  }

  const url = `${webAppURL}?startDate=${encodeURIComponent(startDate)}&endDate=${encodeURIComponent(endDate)}`;

  fetch(url)
    .then(response => response.json())
    .then(data => renderTable(data))
    .catch(err => console.error("Error fetching data:", err));
}

function renderTable(data) {
  const tbody = document.querySelector("#historyTable tbody");
  tbody.innerHTML = ""; // ล้างข้อมูลเก่า

  data.forEach(row => {
    const tr = document.createElement("tr");
    row.forEach(cell => {
      const td = document.createElement("td");
      td.textContent = cell;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

// ตั้ง default วันที่: วันนี้ และย้อนหลัง 31 วัน
window.onload = function() {
  const today = new Date();
  const pastDate = new Date();
  pastDate.setDate(today.getDate() - 31);

  document.getElementById('startDate').value = pastDate.toISOString().slice(0,10);
  document.getElementById('endDate').value = today.toISOString().slice(0,10);

  loadData();
};
</script>

</body>
</html>
