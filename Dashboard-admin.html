<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - History</title>
  <style>
    body { font-family: sans-serif; margin: 20px; background: #f8f9fa; }
    h1 { text-align: center; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; background: #fff; }
    th, td { border: 1px solid #ddd; padding: 6px; font-size: 13px; text-align: center; }
    th { background: #007bff; color: white; }
    tr:nth-child(even) { background: #f2f2f2; }
    img { max-width: 50px; max-height: 50px; }
  </style>
</head>
<body>
  <h1>üìä Admin Dashboard - History</h1>
  <table id="dataTable">
    <thead></thead>
    <tbody></tbody>
  </table>

  <script>
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbx2Y2ChK_CSCUr5xOe5TX0dxSIbOjtnFNWCwqUFRroi2OtLQgDRfxGX41k2O2DHm1Mt/exec"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡∏Ç‡∏≠‡∏á Web App ‡∏à‡∏£‡∏¥‡∏á

    async function fetchAllHistory() {
      try {
        const res = await fetch(`${WEBAPP_URL}?action=getAllHistory`);
        const data = await res.json();
        renderTable(data);
      } catch (err) {
        console.error("Error fetching data:", err);
        document.querySelector("#dataTable tbody").innerHTML = 
          "<tr><td colspan='19'>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>";
      }
    }

    function renderTable(data) {
      const tableHead = document.querySelector("#dataTable thead");
      const tableBody = document.querySelector("#dataTable tbody");
      tableHead.innerHTML = "";
      tableBody.innerHTML = "";

      if (!data || data.length === 0) {
        tableBody.innerHTML = "<tr><td colspan='19'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>";
        return;
      }

      // Header
      const headerRow = document.createElement("tr");
      data[0].forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        headerRow.appendChild(th);
      });
      tableHead.appendChild(headerRow);

      // Rows
      for (let i = 1; i < data.length; i++) {
        const tr = document.createElement("tr");
        data[i].forEach((cell, idx) => {
          const td = document.createElement("td");

          // ‡∏ñ‡πâ‡∏≤ Column N (index 13) ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ
          if (idx === 13 && cell) {
            const img = document.createElement("img");
            img.src = `https://drive.google.com/uc?export=view&id=${cell}`;
            td.appendChild(img);
          } else {
            td.textContent = cell;
          }

          tr.appendChild(td);
        });
        tableBody.appendChild(tr);
      }
    }

    window.onload = fetchAllHistory;
  </script>
</body>
</html>
