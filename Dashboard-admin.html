<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แสดงข้อมูลประวัติ</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; background: #fff; padding: 20px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        h1 { text-align: center; color: #333; }
        .controls { text-align: center; margin-bottom: 20px; }
        .controls label, .controls input, .controls button { margin: 5px; padding: 8px; font-size: 16px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        table, th, td { border: 1px solid #ddd; }
        th, td { padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: bold; }
        tr:nth-child(even) { background-color: #f9f9f9; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ข้อมูลประวัติจาก Google Sheet</h1>
        <div class="controls">
            <label for="startDate">วันที่เริ่มต้น:</label>
            <input type="date" id="startDate">
            <label for="endDate">วันที่สิ้นสุด:</label>
            <input type="date" id="endDate">
            <button id="loadDataButton">โหลดข้อมูล</button>
        </div>
        <table id="dataTable">
            <thead>
                <tr></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            const loadDataButton = document.getElementById('loadDataButton');
            const dataTable = document.getElementById('dataTable');
            const webAppUrl = 'https://script.google.com/macros/s/AKfycbx2Y2ChK_CSCUr5xOe5TX0dxSIbOjtnFNWCwqUFRroi2OtLQgDRfxGX41k2O2DHm1Mt/exec'; // **สำคัญ: เปลี่ยนเป็น URL ที่ Deploy จาก Google Apps Script**

            function setInitialDates() {
                const today = new Date();
                const fortyDaysBefore = new Date();
                fortyDaysBefore.setDate(today.getDate() - 40);
                
                // กำหนดวันที่เริ่มต้นเป็นวันนี้
                startDateInput.value = formatDate(today);
                
                // กำหนดวันสิ้นสุดเป็น 40 วันย้อนหลัง
                endDateInput.value = formatDate(fortyDaysBefore);
            }

            function formatDate(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            async function fetchData(startDate, endDate) {
                try {
                    const url = `${webAppUrl}?startDate=${endDate}&endDate=${startDate}`;
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    const data = await response.json();
                    displayData(data);
                } catch (error) {
                    console.error('Error fetching data:', error);
                    alert('ไม่สามารถดึงข้อมูลได้ โปรดตรวจสอบ URL หรือการเชื่อมต่อ');
                }
            }

            function displayData(data) {
                const tableHeader = dataTable.querySelector('thead tr');
                const tableBody = dataTable.querySelector('tbody');
                tableHeader.innerHTML = '';
                tableBody.innerHTML = '';

                data.header.forEach(headerText => {
                    const th = document.createElement('th');
                    th.textContent = headerText;
                    tableHeader.appendChild(th);
                });

                data.data.forEach(rowData => {
                    const tr = document.createElement('tr');
                    rowData.forEach(cellData => {
                        const td = document.createElement('td');
                        td.textContent = cellData;
                        tr.appendChild(td);
                    });
                    tableBody.appendChild(tr);
                });
            }

            setInitialDates();
            fetchData(startDateInput.value, endDateInput.value);

            loadDataButton.addEventListener('click', () => {
                const startDate = startDateInput.value;
                const endDate = endDateInput.value;
                fetchData(startDate, endDate);
            });
        });
    </script>
</body>
</html>
