<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <style>
    body { font-family: sans-serif; margin: 20px; background: #f8f9fa; }
    h1 { text-align: center; }
    .controls { margin-bottom: 20px; display: flex; gap: 10px; }
    input, select, button { padding: 5px; }
    table { width: 100%; border-collapse: collapse; background: #fff; }
    th, td { border: 1px solid #ddd; padding: 6px; font-size: 13px; text-align: center; }
    th { background: #007bff; color: white; }
    tr:nth-child(even) { background: #f2f2f2; }
  </style>
</head>
<body>
  <h1>üìä Admin Dashboard</h1>

  <!-- ‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
  <div class="controls">
    <label>‡πÄ‡∏£‡∏¥‡πà‡∏°: <input type="date" id="startDate"></label>
    <label>‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î: <input type="date" id="endDate"></label>
    <button onclick="fetchData()">‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </div>

  <!-- ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß -->
  <div class="controls">
    <label>‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå:
      <select id="filterColumn"></select>
    </label>
    <input type="text" id="filterValue" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£">
    <button onclick="applyFilter()">‡∏Å‡∏£‡∏≠‡∏á</button>
  </div>

  <table id="dataTable">
    <thead></thead>
    <tbody></tbody>
  </table>

  <script>
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbx2Y2ChK_CSCUr5xOe5TX0dxSIbOjtnFNWCwqUFRroi2OtLQgDRfxGX41k2O2DHm1Mt/exec"; // üëà ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡∏à‡∏£‡∏¥‡∏á
    let originalData = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤
    let headers = [];

    async function fetchData() {
      const startDate = document.getElementById("startDate").value;
      const endDate = document.getElementById("endDate").value;
      let url = `${WEBAPP_URL}?action=getHistory`;
      if (startDate) url += `&startDate=${startDate}`;
      if (endDate) url += `&endDate=${endDate}`;

      const res = await fetch(url);
      const data = await res.json();

      if (!data || data.length === 0) {
        renderTable([]);
        return;
      }

      headers = data[0];
      originalData = data.slice(1);
      renderTable(originalData);
      fillFilterOptions();
    }

    function renderTable(data) {
      const tableHead = document.querySelector("#dataTable thead");
      const tableBody = document.querySelector("#dataTable tbody");
      tableHead.innerHTML = "";
      tableBody.innerHTML = "";

      if (!data || data.length === 0) {
        tableBody.innerHTML = "<tr><td colspan='20'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>";
        return;
      }

      // Header
      const headerRow = document.createElement("tr");
      headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        headerRow.appendChild(th);
      });
      tableHead.appendChild(headerRow);

      // Data rows
      data.forEach(row => {
        const tr = document.createElement("tr");
        row.forEach(cell => {
          const td = document.createElement("td");
          td.textContent = cell;
          tr.appendChild(td);
        });
        tableBody.appendChild(tr);
      });
    }

    function fillFilterOptions() {
      const filterColumn = document.getElementById("filterColumn");
      filterColumn.innerHTML = "<option value=''>--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å--</option>";
      headers.forEach((h, idx) => {
        const opt = document.createElement("option");
        opt.value = idx;
        opt.textContent = h;
        filterColumn.appendChild(opt);
      });
    }

    function applyFilter() {
      const colIndex = document.getElementById("filterColumn").value;
      const filterValue = document.getElementById("filterValue").value.trim();
      if (!colIndex || !filterValue) {
        renderTable(originalData);
        return;
      }
      const filtered = originalData.filter(row =>
        String(row[colIndex]).includes(filterValue)
      );
      renderTable(filtered);
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• default ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
    window.onload = fetchData;
  </script>
</body>
</html>
