<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
  body {
    font-family: 'Prompt', sans-serif;
    margin: 0;
    padding: 20px;
    background: #f0f2f5;
    color: #333;
  }
  .container {
    max-width: 600px;
    margin: auto;
  }
  .header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 30px;
    background: linear-gradient(135deg, #1994b6, #36a761);
    padding: 25px;
    border-radius: 15px;
    color: #fff;
  }
  .profile-pic {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid rgba(255, 255, 255, 0.5);
  }
  .greeting {
    font-size: 20px;
    font-weight: 600;
  }
  .motivation {
    font-size: 14px;
    color: rgba(255,255,255,0.8);
    margin-top: 5px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 12px;
    text-align: center;
  }
  th {
    background: #e0f7fa;
  }
</style>
<!-- ‡πÇ‡∏´‡∏•‡∏î LIFF SDK -->
<script src="https://static.line-scdn.net/liff/edge/2.25/sdk.js"></script>
<script>
const liffId = "2007956727-6V7DrnMD"; // <-- ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
const GAS_URL = "https://script.google.com/macros/s/AKfycbypGDcud4AH8zMe4ySfQpcG8CxvFpLaD83E8C0t739Nh8A2bRTnr1-4UpxGwqSJ0FRu/exec"; // <-- URL Web App ‡∏Ç‡∏≠‡∏á Apps Script

async function initDashboard() {
  await liff.init({ liffId });

  if (!liff.isLoggedIn()) {
    liff.login();
    return;
  }

  const profile = await liff.getProfile();
  document.getElementById("profilePic").src = profile.pictureUrl;

  // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Apps Script ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Balance + Records
  fetch(`${GAS_URL}?action=getBalance&userId=${profile.userId}`)
    .then(res => res.json())
    .then(data => {
      if (data.error) {
        alert(data.error);
        return;
      }

      // ‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‡∏à‡∏≤‡∏Å Column B ‡∏´‡∏ô‡πâ‡∏≤ Balance
      document.getElementById("empName").innerText = data.set1[1];

      // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á
      window.balanceSet1 = data.set1;
      window.balanceSet2 = data.set2;

      renderTables();
    })
    .catch(err => console.error(err));
}

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥
function renderTables() {
  if (!window.balanceSet1 || !window.balanceSet2) return;

  const remainTable = document.getElementById("remainTable");
  const usedTable = document.getElementById("usedTable");

  // ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏•‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏à‡∏≤‡∏Å Balance)
  const remainData = [
    { type: "‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô", days: window.balanceSet1[3] },
    { type: "‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢", days: window.balanceSet1[4] },
    { type: "‡∏•‡∏≤‡∏Å‡∏¥‡∏à", days: window.balanceSet1[5] }
  ];
  remainData.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${row.type}</td><td>${row.days}</td>`;
    remainTable.appendChild(tr);
  });

  // ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (‡∏à‡∏≤‡∏Å Records)
  const usedData = [
    { type: "‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô", days: window.balanceSet2[3] },
    { type: "‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢", days: window.balanceSet2[4] },
    { type: "‡∏•‡∏≤‡∏Å‡∏¥‡∏à", days: window.balanceSet2[5] },
    { type: "‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô‡∏™‡∏∞‡∏™‡∏°", days: window.balanceSet2[6] }
  ];
  usedData.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${row.type}</td><td>${row.days}</td>`;
    usedTable.appendChild(tr);
  });
}

document.addEventListener("DOMContentLoaded", initDashboard);
</script>
</head>
<body>
<div class="container">
  <div class="header">
    <img src="" alt="Profile" class="profile-pic" id="profilePic">
    <div>
      <div class="greeting">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, <span id="empName">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</span> üëã</div>
      <div class="motivation">‡∏û‡∏±‡∏Å‡∏ö‡πâ‡∏≤‡∏á‡∏Å‡πá‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏´‡πâ‡∏≤‡∏°‡∏¢‡∏≠‡∏°‡πÅ‡∏û‡πâ üí™</div>
    </div>
  </div>

  <h3>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏•‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h3>
  <table id="remainTable">
    <tr><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</th></tr>
  </table>

  <h3>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</h3>
  <table id="usedTable">
    <tr><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</th></tr>
  </table>
</div>
</body>
</html>
